# IO体系结构与访问设备

应用程序通过  /dev/xyzx  打开读写等操作

## 系统总线
尽管外设的范围可能看上去是无限的，他们并不直接连接到CPU，而是通过总线连接起来。总线负责设备与CPU之间及各个设备之间的通信。如下为代表性总线。

PCI（Peripheral Component Interconnect）
ISA（Industrial Standard Architecture）
SBus
IEEE1394
SCSI（Small Computer System Interface）
USB（Universal Serial Bus）
并口与串口（Parallel and Serial Interface）

## 与外设交互
与外设通信的方法，有几种方法可以与连接到系统的硬件通信
A  I/O端口
使用IA-32和很多其他体系结构上都有I/0端口，在这种情况下，内核发送数据给I/0控制器。数据的目标设备通过唯一的端口号标识，数据被传输到设备进行处理。处理器管理一个独立的虚拟地址空间，可以用于管理所有I/0地址。I/0地址空间不关联到普通 的系统内核。因为端口也可以映射到内存，这样会引起混淆。在IA-32体系结构上，端口地址空间由2的16次方(大约64000)个不同的8位地址组成，通过0x0到0xFFFF之间的数字唯一标识。
B  I/O内存映射
程序员必须寻址很多设备，与内存的处理方式类似。因此现在处理器提供对I/0端口进行内存映射，将特殊外设的端口地址映射到普通内存中。
C  轮询和终端
轮询(polling)策略比较简单，只需要重复询问设备数据是否可用，如果可用，则处理器取回数据。中断策略比较好。每个CPU都提供中断线，可由各个系统设备共享，每个中断通过一个唯一号码标识，内核对使用的每个中断提供一个服务例程。

## 通过总线控制设备
并非所有设备都是直接通过IO语句寻址，也有通过总线系统访问的。具体的方式与所使用的总线和设备相关。

# 2 访问设备
设备特殊文件(设备文件)用于访问扩展设备。这些文件并不关联到硬盘或任何其他的存储介质上的数据段，而是建立了与某个设备驱动程序的连接，以支持与扩展设备的通信。
就应用程序而言，普通文件和设备文件的处理有一定差别。二者都是可以通过同样的库函数处理。

## 2.1 字符设备、块设备和其他设备
根据外设与系统之间交换数据的方法，可以将设备分为几种类别。有些设备非常适合于面向字符的数据交换，因为数据传输量很低。其他的设备则更适合于处理包含固定数目字节的数据块。内核会区分字符设备和块设备。

标识设备文件(查询:vico@ubuntus$Is-l/dev)
1 /dev目录下一些成员，特别在访问权限上面，访问之前的字母是 b 或者 c,分别代表块设备和字符设备；设备文件没有文件长度，而增加另外两个值，分别是主设备号和从设备号

2 /dev/hda, /dev/hdb, /dev/sda,  dev/sdb:hsa（一般指IDE接口有硬盘，sda一般指sata接口硬盘）

3  热插拔消息：新设备
每当内核检测到一个设备时，都会创建一个内核对象kobject。该对象借助于sysfs文件系统导出到用户层，内核还向用户空间发送一个热插拔消息。

4  网卡及其他设备
字符设备和块设备不是内核管理的全部设备类型。网卡在内核中具有特殊地位，它无法融入到分类方案当中，事实很明显：网卡没有设备文件。相反，用户程序必须使用套接字与网卡通信。套接字就是一个抽象层，对所有网卡提供一个抽象视图。标准库的网络相关寒素调用socket call系统调用与内核通信交互，进而访问网卡。

动态创建设备文件
/dev中的设备结点一般是在基于磁盘的文件系统中静态创建的。随着支持设备越来越多，必须安置和管理越来越多的项，典型发布版大约包含20000项。几乎所有的发布版都将/dev内容的管理工作切换到udevd，这是一个守护进程，允许从用户层动态创建设备文件。
udevd基本思想，即使从用户层管理设备文件，内核的支持也是绝对必须的，否则就无法判断系统上有哪些设备可用。