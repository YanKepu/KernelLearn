# 邻接子系统的核心
基础知识
Linux邻接子系统负责发现当前链路上的结点，并且将L3(网络层)地址转换为L2(数据链路层)地址。在IPv4当中，实现这种转换的协议为地址解析协议Address ResolutionProtocol，ARP)，而在IPv6则为邻居发现协议(Neighbour Discovery Protocol，NDISC或ND)，邻接子系统为执行L3到L2映射提供了独立于协议的基础设施。
在IPv4中，使用邻接协议为ARP，相应的请求和应答分别被称为ARP请求和ARP应答在IPv6中，使用的邻接协议为NDISC，相应的请求和应答分别称为邻居请求和邻居通告

主要是讲了ARP协议的处理和ARP表项的基础结构体和构建，建议结合ICMP协议一起学习，把一个完整的网络协议流程给打通


## NDISC协议
用来避免重复IPv4地址的

2、邻接子系统是用来干什么？
在第二层发送数据包时，为创建L2报头，需要使用使用L2目标地址，使用邻接系统进行请示和应答，便可以根据

源码：
include/net/neghbour.h

## 创建和释放邻居
创建邻居： __neigh_create
首先调用 neigh_alloc()，分配一个邻居对象并执行各种初始化工作
将dead标志初始化为0，并将邻居对象添加到邻居散列表中，方法neigh_release()将邻居的应用计数器减一，当其为0时，调用方法neigh_destro()将邻居对象释放。

释放邻居： __neigh_release

用户空间和邻接子系统交互
管理ARP表，可使用iproute2包中的命令ip neigh，也可以使用net_tools包中的命令arp

## 添加/删除邻居条目
添加使用命令ip neigh add,执行方法

# ARP
以太网中，硬件地址mac，长度48bit，发送IPV4数据包时，目标IPV4是已知的，但是需要创建以太网报文

include\uapi\linux\if_arp.h
arp协议报头使用arphdr表示
## 发送请求

net\ipv4\ip_output.c
__ipv4_neigh_lookup_norup